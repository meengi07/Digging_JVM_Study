# 자바

- 프로그래밍 언어뿐 아니라 여러가지 소프트웨어와 명세로 구성된 기술 시스템
- 크로스 플랫폼 소프트웨어를 개발하고 배포하는데 필요한 모든 것을 제공
- 상당히 안전한 메모리 관리 시스템을 갖췄다.
- 런타임에 핫코드를 감지, 컴파일하고 최적화하여 자바 애플리케이션이 최상의 성능을 내도록 도와준다.
- 표준 API 풍부, 수많은 기업과 오픈 소스 커뮤니티에서 제공하는 다양한 기능의 서드 파티 라이브러리 활용이 가능하다.


# 자바 기술 시스템

일반적으로 자바 가상 머신위에서 동작하는 코틀린, 클로저, JRuby, 그루비 등 프로그래밍 언어와 그 외 관련 프로그램들도 자바 기술 시스템에 속한다.
전통적으로 자바 기술 시스템은 다음 요소들을 포함한다.
- 자바 프로그래밍 언어
- (다양한 하드웨어 플랫폼용) 자바 가상 머신 구현
- 클래스 파일 포맷
- 자바 클래스 라이브러리 API(표준 API)
- 다른 기업과 오픈 소스 커뮤니티에서 제공하는 서드 파티 클래스 라이브러리

# JDK
- 자바 프로그래밍 언어, 자바 가상머신, 자바 클래스 라이브러리를 묶은것.
- 자바 프로그램 개발에 필요한 최소한의 환경
- JDK 용어는 자바 기술 시스템 전체 세대를 지칭할때도 자주 쓰인다.

# JRE
- 자바 SE API와 자바 가상 머신 그리고 배포 기술까지 묶은것.
- 자바 프로그램을 실행할수 있는 표준 환경을 제공

# 핫스팟 가상머신

서버용 제품처럼 장기간 운용되는 애플리케이션에서는 자주 실행되는 핫 코드를 탐지하여 네이티브 코드로 컴파일한다.
불과 몇년 전만 하더라도 많은 CPU코어를 사용할 수 없었고 CPU코어가 하나뿐인 사용자를 위해 만들어진 것이 HotSpot 클라이언트 컴파일러이다.
핫스팟 가상 머신은 기본적으로 JIT 컴파일러를 두개 내장하고 있다.

    1. 클라이언트 컴파일러(C1 컴파일러)
    컴파일 속도가 빠른 대신 최적화를 적게한다.
    서버 컴파일러보다 먼저 컴파일을 시작한다.
    Start-Up 시간이 빠르다. 하지만 최적화가 덜하기 때문에 코드실행은 서버가 더 빠르다.

    2. 서버 컴파일러(C2 컴파일러)
    컴파일전에 많은 정보를 수집하여 컴파일 속도는 느리지만, 더 많은 최적화에 중점을 둔다.
    서버 컴파일러는 절대로 모든 코드를 컴파일하지 않는다
    여기에 인터프리터까지 포함하여 총 3개의 실행 메커니즘이 협력하여 핫스팟 가상 머신의 실행 서브 시스템을 구성한다.

예전에는 HotSpot JVM이 주로 사용되었지만, 지금은 GraalVM이나 OpenJ9 등 다양한 JVM 구현이 주목받고 있다.

GraalVM컴파일러는 C2컴파일러를 대체할 목적으로 핫스팟에 도입되었다.

    - 장점
    컴파일된 코드의 출력 품질이 좋다.
    개발 효율과 확장성 측면에서는 C2와 비교하기 어려울 만큼 훌륭하다.
    부분 탈출 분석(partial escape analysis) 처럼 C2 보다 복잡한 최적화도 수행할 수 있다.
    또한 맞춤형 가정 등을 추가해 공격적 예측 최적화(aggressivfe speculative optimization)를 적용하기도 수월하다.


# 네이티브를 향한 발걸음
장시간 실행할 필요가 없거나 크기가 작은 애플리케이션의 경우 자바로 개발하면 단점이 있다.
HelloWorld를 실행하려 해도 불필요한 JRE 가 필요한 점
애플리케이션 아키텍처의 중심은 거대한 단일 아키텍처 -> 작은 마이크로서비스 아키텍처 로 빠르게 옮겨가고 있지만, 자바는 이 추세와 잘 맞지 않는다.

마이크로 서비스 아키텍처에서는 분할 된 서비스 각각이 많은 메모리를 쓸 일은 없다. 고가용성 서비스 클러스터를 활용하면 언제든지 중단하고 업데이트할수 있기때문에,  단일 서비스를 중단 없이 실행하기 위해 리소스가 줄어든다.  하지만 자바는 구동 시간이 길고 최고 성능을 내기 까지 예열이 필요하므로 마이크로 서비스가 요구하는 특성과는 반대이다.
이러한 단점으로 최근 JDK 에는 애플리케이션 클래스 데이터 공유 (Application Class Data Sharing, AppCDS)와 노옵(no-op) 가비지 컬렉터인 엡실론 등의 기술이 포함되었다.

AppCDS
    - 로딩한 클래스 정보를 캐시해 두어 다음번 구동 시간을 줄이는 기술

엡실론
    - 메모리를 할당만 해줄 뿐 회수는 하지않는 커렉터
    - 간단한 작업을 빠르게 처리후 즉시 종료하는 애플리케이션에 적합
    - 더 급진적인 기술로는 애플리케이션을 실행하기 전에 네이티브 코드로 컴파일해두는 AOT 컴파일이 있다.

AOT(Ahead of Time)

    - 장점
    자바 가상머신은 애플리케이션을 우선 실행한후 JIT 컴파일을 써서 빈번하게 실행되는 로직을 네이티브 코드로 바꿔 실행했다.
    하지만 컴파일을 미리 해두면 예열 과정을 건너 뛰고 처음부터 네이티브 코드를 실행할 수 있다.
    시간 압박 없이 프로그램 전체를 완벽하게 분석하여 최적화할수 있다.

    - 단점
    한번 작성하면 어디서든 실행되는 자바와 다르게, 하드웨어와 운영 체제별로 따로 컴파일해 배포해야한다.
    컴파일할 코드에 대한 모든 것을 컴파일 타임에 알수 있어야 하므로, 자바 동적 링크 특성이 크게 줄어든다.

서브스트레이트 VM(Substrate VM)
사전 컴파일된 네이티브 코드를 핫스팟 가상 머신 없이 실행되는 기술로 독자적인 예외 처리, 스레드 관리, 메모리 관리, 자바 네이티브 인터페이스 을 갖춘 작은 런타임 환경
    
    - 장점
    자바 가상 머신이 수행하던 초기화 과정을 건너뛰고, 프로그램을 곧바로 실행하여 초기 구동 시간을 줄인다.
    메모리 사용량을 크게 줄여준다.(핫스팟 가상 머신은 그 자체로도 많은 메모리를 사용한다)
    
    - 단점
    컴파일러가 찾을수 없는 코드나 클래스 라이브러리를 동적으로 읽어들일수 없어 프로그램이 완결된 형태여야 한다.
 
 