## 1.1 들어가며
#### 자바의 주요 특징
- 하드웨어 플랫폼이란 족쇄를 제거
- 안전한 메모리 관리 시스템(메모리 누수와 같은 문제를 예방)
- 런타임에 핫 코드를 감지, 컴파일 및 최적화하여 최상의 성능을 냄
- 풍부한 표준 API와 더불어 다양한 기능의 서드 파티 라이브러리가 존재
## 1.2 자바 기술 시스템
#### 자바 기술 시스템의 포함 요소
- 자바 프로그래밍 언어
- 자바 가상 머신 구현
- 클래스 파일 포맷
- 자바 클래스 라이브러리 API(표준 API)
- 다른 기업과 오픈 소스 커뮤니티에서 제공하는 서드 파티 클래스 라이브러리
#### JDK와 JRE
![[자바 기술 시템 구스성요소.png]]
- JDK - 자바 프로그래밍 언어, 자바 가상 머신, 자바 클래스 라이브러리의 묶음
- JRE - 자바 프로그램을 실행할 수 있는 표준 환경
## 1.3 자바의 과거와 현재
- JDK 7 개발 중, 오라클이 썬을 인수
- 오라클 인수 후 14-03-18 JDK 8이 출시되며 모던 자바의 시작을 알림
- 현재는 2년 주기로 LTS 버전을 출시(17 -> 21)
- JDK 11 출시에 맞춰 오라클은 남은 상용 기능을 모두 오픈 소스로 공개
- OpenJDK와 오라클 JDK는 대부분의 소스 코드를 공유하며 기능 역시 거의 같음
- 단 OpenJDK의 경우 오라클의 직접적인 업데이트 지원이 6개월로 제한됨
- 자바의 유료화는 비즈니스 사용자에게만 해당하며, 비즈니스 사용자는 JDK를 지속해서 업그레이드하거나 유료 지원 서비스를 구매하는 것 중에서 선택해야 한다.
## 1.4 자바 가상 머신 제품군
많은 개발자들이 JVM을 오라클 JDK의 핫스팟 가상 머신과 동일시 한다.
하지만 실제로 JVM은 다양한 제품군이 존재한다.
#### 1.4.1 썬 클래식 VM과 이그잭트 VM
- **썬 클래식 VM**
    - 세계 최초의 상용 JVM, JDK 1.0에 포함된 가상 머신
    - 자바 코드를 순전히 인터프리터 방식으로 실행
- **이그잭트 VM**
    - 클래식 VM이 직면한 효율성 문제를 개선하기 위해 나온 VM
    - 현대적인 고성능 가상 머신의 프로토타입
#### 1.4.2 핫스팟 VM
- 오라클과 OpenJDK의 기본 가상 머신이자 가장 널리 사용되는 JVM
- 핵심 기술은 핫 코드 감지다.
    - 해당 기술은 컴파일했을 때 효과를 가장 크게 볼 수 있는 코드 영역을 런타임에 알아내어 JIT 컴파일러에 알려주는 방식으로 작동한다.
#### 1.4.3 모바일, 임베디드 VM
- 자바 ME 제품군에 포함된 가상 머신은 현재 죽었다고 봐도 무장하다.
#### 1.4.4 BEA JRockit과 IBM J9 VM
- 두 가상머신은 썬과 오라클 외의 기업에서 개발한 가상 머신이다.
- 이 중 J9 여전히 현역으로 활동 중이며, 핫스팟 머신보다 역할별로 모듈화가 잘 이루어져 있다.
#### 1.4.5 BEA 리퀴드 VM과 어줄 VM
- 특정 하드웨어 플랫폼에서만 구동되는 소프트웨어 + 하드웨어가 통합된 형태의 가상머신도 존재한다.
- 이러한 종류의 대표적인 가상 머신이 바로 리퀴드 VM과 어줄 VM이다.
- 리퀴드 VM을 작동시킬 때 OS는 필요 없다.
#### 1.4.6 아파치 하모니와 안드로이드 아트 VM
- 두 가상 머신은 정확히는 JVM은 아니다.
- 다만 두 가상 머신의 기술 시스템은 자바 세계에 커다란 영향을 줬다.
#### 1.4.7 마이크로소프트 JVM
- 썬과 고소하며 역사의 뒤안길로 사라짐
#### 1.4.8 수많은 아이디어의 각축전
- 상업적 용도로 이용되지 못했거나 주류 시장에서 쓰이진 못했지만 연구 목적이나 특정 아이디를 검증할 목적으로 구현된 가상 머신들이 존재한다.
- KVM, JCVM, 스쿽 VM, 자바인 자바, 맥신 VM, 자이크스 RVM 등이 존재한다.
## 1.5 자바 기술의 미래
해당 절에선 오라클 연구소에서 연구 중인 그랄 VM, 발할라, 앰버, 파나마 프로젝트에 대해 소개한다.
#### 1.5.1 언어 독립
- 18년 4월 오라클 연구소는 그랄 VM이라는 신기술을 발표했다.
- 그랄 VM은 핫스팟 가상 머신 위에 구축된 크로스 언어 풀 스택 가상 머신이다.
- 그랄 VM은 진정한 의미에서 물리 머신에 대응하는 고수준 언어 가상 머신이다.
  ![[그랄 VM 아키텍처.png]]
  그랄 VM은 입력된 중간 표현을 자동으로 최적화하고 런타임에 JIT 컴파일까지 해 주기에 때론 네이티브 컴파일러들보다 실행 성능이 나을 수 있다.
#### 1.5.2 차세대 JIT 컴파일러
- 핫스팟 VM은 JIT 컴파일러를 두 개 내장하고 있다.
    - 하나는 컴파일 속도가 빠른 대신 최적화를 적게 하는 클라이언트 컴파일러(C1 컴파일러)
    - 다른 하나는 컴파일 속도는 느리지만 더 많은 최적화를 적용하는 서버 컴파일러(C2 컴파일러)
    - 여기에 인터프리터까지 포함해 총 3개의 실행 메커니즘이 협력하여 핫스팟 VM의 실행 서브 시스템을 구성한다.
- JDK 10부터는 그랄 컴파일러가 추가되었다.
    - 그랄 컴파일러는 C2 컴파일러를 대체할 목적으로 핫스팟에 도입되었다.(C2의 복잡도가 매우 올라갔기 때문)
- JDK 16부터는 개발 관리 효율을 높이기 위해 그랄 컴파일러를 그랄 VM으로  옮겼다.
#### 1.5.3 네이티브를 향한 발걸음
애플리케이션 아키텍처의 중심이 모놀리식에서 마이크로 서비스로 이동하고 있다. 이러한 추세는 자바와 잘 맞지 않는다.
그 이유는 자바의 긴 구동 시간, 성능을 충분히 내기까지 웜업이 필요하기 때문이다.
이러한 문제를 해결하기 위해 AppCDS, 엡실론, AOT 등의 기술들을 지원했다. 하지만 각각이 가진 단점들 때문에 그 한계가 명확했다.

이후 Substrate VM이 등장했다. 그랄 VM의 한 요소인 Substrate VM은 사전 컴파일된 네이티브 코드를 핫스팟 가상 머신 없이 실행하는 기술로 독자적인 예외처리, 스레드 및 메모리 관리와 JNI접근 메커니즘을 갖춘 작은 런타임 환경이다.
이러한 기술 덕분에 Substrate VM은 메모리 사용량과 구동 시간을 크게 개선했다.
#### 1.5.4 유연한 뚱뚱이
핫스팟 VM은 다양한 분야의 애플리케이션을 지원할 수 있도록 완전한 기능을 갖춘 JVM이다. 덕분에 무겁다는 이미지를 가지게 되고, 민첩함과는 거리가 멀게 되었다.
하지만 기존의 단점인 모듈화를 해결하며 컴파일할 때 원하는 기능을 지정해 맞춤형으로 VM을 만들 수 있게 됐다.

연이은 리팩터링과 개방을 덕분에 핫스팟 VM의 코드 복잡도와 덩치가 계속 커져도 낡지 않은 아키텍처를 가지게 됐다.
#### 1.5.5 언어 문법의 지속적인 개선
- **발할라 프로젝트**
    - 값 타입과 원시 타입을 일반화한 제네릭 타입을 제공하고 불변 타입과 비참조 타입을 명시적으로 선언할 수 있게 한다.
    - 이를 통해 오토 박싱/언박싱에 드는 오버헤드를 줄일 수 있다.
- **파나마 프로젝트**
    - JVM과 네이티브 코드의 경계를 허문다.
    - JNI 방식은 번거롭고, 빈번한 호출은 성능 부하를 만든다.
    - 하위 프로젝트로 외부 함수 및 메모리 API, 벡터 API, Jextract가 있다.